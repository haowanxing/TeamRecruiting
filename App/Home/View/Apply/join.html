<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=0">
  <title>{$index_title}{$web_title}</title>
  <meta name="description" content="{$apply_description}"/>
  <meta name="keywords" content="{$apply_keywords}"/>
  <load href="__PUBLIC__/css/weui.min.css"/>
  <link href="__PUBLIC__/css/common.css" rel="stylesheet">
  <load href="__PUBLIC__/js/jquery-1.11.3.min.js"/>
</head>
<body>
<div class="">
  <h1 class="page_title">{$index_title}</h1>
  <p class="page_desc">期待您的加入</p>
</div>
<form class="form-user" type="post" action="{:U('Apply/doUpdate')}">
  <input name="tid" value="{$team_id}" type="hidden"/>
  <div class="weui_cells weui_cells_form">
    <div class="weui_cell">
      <div class="weui_cell_hd">
        <div class="weui_label">姓名</div>
      </div>
      <div class="weui_cell_bd weui_cell_primary">
        <input type="text" name="name" class="weui_input" placeholder="请输入您的姓名"/>
      </div>
    </div>
    <div class="weui_cell weui_cell_primary ">
      <div class="weui_cell_hd">
        <label class="weui_label">联系方式</label>
      </div>
      <div class="weui_cell_bd weui_cell_primary">
        <input class="weui_input" name="phone" type="tel" placeholder="请输入手机号码">
      </div>
    </div>
    <div class="weui_cell weui_cell_select">
      <div class="weui_cell_hd">
        <label class="weui_label" style="padding-left: 15px;">性别</label>
      </div>
      <div class="weui_cell_bd weui_cell_primary">
        <select name="sex" class="weui_select">
          <option value="1">男</option>
          <option value="2">女</option>
          <option value="3">其他(我们不排斥)</option>
        </select>
      </div>
    </div>
    <if condition="$applyOp.qq eq 1">
      <div class="weui_cell weui_cell_primary ">
        <div class="weui_cell_hd">
          <label class="weui_label">QQ号码</label>
        </div>
        <div class="weui_cell_bd weui_cell_primary">
          <input class="weui_input" name="qq" type="number" placeholder="">
        </div>
      </div>
    </if>
    <if condition="$applyOp.origin eq 1">
      <div class="weui_cell">
        <div class="weui_cell_hd">
          <label class="weui_label">籍贯</label>
        </div>
        <div class="weui_cell_bd weui_cell_primary">
          <input class="weui_input" name="origin" type="text" placeholder="湖北武汉?">
        </div>
      </div>
    </if>
    <if condition="$applyOp.nation eq 1">
      <div class="weui_cell weui_cell_select">
        <div class="weui_cell_hd">
          <div class="weui_label" style="padding-left: 15px;">民族</div>
        </div>
        <div class="weui_cell_bd weui_cell_primary">
          <select name="nation" class="weui_select">
            <volist name="nations" id="vo">
              <option value="{$vo.id}">{$vo.name}</option>
            </volist>
          </select>
        </div>
      </div>
    </if>
  </div>

  <div class="weui_cells_title">学生信息</div>
  <div class="weui_cells weui_cells_form">
    <if condition="$applyOp.stuId eq 1">
      <div class="weui_cell">
        <div class="weui_cell_hd">
          <label class="weui_label">学号</label>
        </div>
        <div class="weui_cell_bd weui_cell_primary">
          <input class="weui_input" name="stuId" type="number" pattern="[0-9]*" placeholder="请输入您的学号">
        </div>
      </div>
    </if>
    <div class="weui_cell weui_cell_select">
      <div class="weui_cell_hd">
        <div class="weui_label" style="padding-left: 15px;">学院</div>
      </div>
      <div class="weui_cell_bd weui_cell_primary">
        <select id="select_dp" name="dep" class="weui_select">
          <volist name="departments" id="dpmt">
            <option value="{$dpmt.id}">{$dpmt.dpname}</option>
          </volist>
          <option value="999">其他</option>
        </select>
      </div>
    </div>
    <div class="weui_cell weui_cell_select">
      <div class="weui_cell_hd">
        <div class="weui_label" style="padding-left: 15px;">专业</div>
      </div>
      <div class="weui_cell_bd weui_cell_primary">
        <select id="select_mj" name="major" class="weui_select">
          <option value="1">软件工程</option>
          <option value="2">网络工程</option>
          <option value="3">计算机科学与技术</option>
          <option value="4">自动化</option>
          <option value="5">智能科学与技术</option>
          <option value="6">轨道交通信号与控制</option>
          <option value="999">其他</option>
        </select>
      </div>
    </div>
  </div>
  <div class="weui_cells_title">个人兴趣</div>
  <div class="weui_cells weui_cells_form">
    <div class="weui_cell">
      <div class="weui_cell_bd weui_cell_primary">
        <textarea name="interest" class="weui_textarea" placeholder="请输入您的兴趣(可选)" rows="2"></textarea>
        <div class="weui_textarea_counter"><span>0</span>/200</div>
      </div>
    </div>
  </div>
  <if condition="$applyOp.skill eq 1">
    <div class="weui_cells_title">特长/技能</div>
    <div class="weui_cells weui_cells_form">
      <div class="weui_cell">
        <div class="weui_cell_bd weui_cell_primary">
          <textarea name="interest" class="weui_textarea" placeholder="(可选)" rows="2"></textarea>
          <div class="weui_textarea_counter"><span>0</span>/200</div>
        </div>
      </div>
    </div>
  </if>
</form>
<if condition="$applyOp.pic eq 1">
  <div class="weui_cells weui_cells_form">
    <div class="weui_cell">
      <div class="weui_cell_bd weui_cell_primary">
        <div class="weui_uploader">
          <div class="weui_uploader_hd weui_cell">
            <div class="weui_cell_bd weui_cell_primary">展示自我</div>
            <div class="weui_cell_ft js_counter">0/6</div>
          </div>
          <div class="weui_uploader_bd">
            <ul class="weui_uploader_files">
              <!-- 预览图插入到这 -->
            </ul>
            <div class="weui_uploader_input_wrp">
              <input class="weui_uploader_input js_file" type="file" accept="image/*" multiple="">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</if>
<div class="weui_cells_tips">提示:请如实填写上述信息,我们将为您保密!</div>

<div class="weui_btn_area">
  <button type="submit" class="weui_btn weui_btn_primary ajax-post" target-form="form-user">我要报名</button>
</div>

<include file="./Public/Static/tpl/copyright.html"/>


<div class="weui_dialog_alert" style="display: none;">
  <div class="weui_mask"></div>
  <div class="weui_dialog">
    <div class="weui_dialog_hd"><strong class="weui_dialog_title">警告</strong>
    </div>
    <div class="weui_dialog_bd">弹窗内容，告知当前页面信息等</div>
    <div class="weui_dialog_ft">
      <a href="javascript:;" class="weui_btn_dialog primary">确定</a>
    </div>
  </div>
</div>

<load href="__PUBLIC__/js/zepto.min.js"/>
<load href="__PUBLIC__/Static/layer/layer.js"/>
<load href="__PUBLIC__/js/ajax.js"/>

<script>
  $("#select_dp").change(function () {
    var pdId = $(this).children('option:selected').val();
    var sendData = {id: pdId};
    $.ajax({
      url: "{:U('Api/getMajor')}",
      type: 'POST',
      data: sendData,
      dataType: 'json',
      success: function (data) {
//      console.log(data);
        $("#select_mj").children("option").remove();
        data.forEach(function (e) {
          console.log(e);
          var $newNode = $("<option value=\"" + e.id + "\">" + e.mjname + "</option>");
          $("#select_mj").append($newNode);
        });
        var $newNode = $("<option value=\"999\">其他</option>");
        $("#select_mj").append($newNode);
      },
    })
  });
</script>
<script>
  $.weui = {};
  $.weui.alert = function (options) {
    options = $.extend({title: '警告', text: '警告内容'}, options);
    var $alert = $('.weui_dialog_alert');
    $alert.find('.weui_dialog_title').text(options.title);
    $alert.find('.weui_dialog_bd').text(options.text);
    $alert.on('touchend click', '.weui_btn_dialog', function () {
      $alert.hide();
    });
    $alert.show();
  };

  $(function () {
    // 允许上传的图片类型
    var allowTypes = ['image/jpg', 'image/jpeg', 'image/png', 'image/gif'];
    // 1024KB，也就是 1MB
    var maxSize = 2 * 1024 * 1024;
    // 图片最大宽度
    var maxWidth = 300;
    // 最大上传图片数量
    var maxCount = 6;
    var hasCount = 0;
    $('.js_file').on('change', function (event) {
      var files = event.target.files;

      // 如果没有选中文件，直接返回
      if (files.length === 0) {
        return;
      }

      if (files.length > maxCount - hasCount) {
        $.weui.alert({text: '你本次选择超过' + (maxCount - hasCount) + '张图片'});
        return;
      }

      for (var i = 0, len = files.length; i < len; i++) {
        var file = files[i];
        var reader = new FileReader();

        // 如果类型不在允许的类型范围内
        if (allowTypes.indexOf(file.type) === -1) {
          $.weui.alert({text: '该类型不允许上传'});
          continue;
        }

        if (file.size > maxSize) {
          $.weui.alert({text: '图片太大，不允许上传'});
          continue;
        }

        if ($('.weui_uploader_file').length >= maxCount || files.length > maxCount) {
          $.weui.alert({text: '最多只能上传' + maxCount + '张图片'});
          return;
        }

        hasCount++
        ;
        reader.onload = function (e) {
          var img = new Image();
          img.onload = function () {
            // 不要超出最大宽度
            var w = Math.min(maxWidth, img.width);
            // 高度按比例计算
            var h = img.height * (w / img.width);
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            // 设置 canvas 的宽度和高度
            canvas.width = w;
            canvas.height = h;
            ctx.drawImage(img, 0, 0, w, h);
            var base64 = canvas.toDataURL('image/png');
            // 插入到预览区
            var $preview = $('<li class="weui_uploader_file weui_uploader_status" style="background-image:url(' + base64 + ')"><div class="weui_uploader_status_content">0%</div></li>');
            $('.weui_uploader_files').append($preview);
            var num = $('.weui_uploader_file').length;
            $('.js_counter').text(num + '/' + maxCount);

            // 然后假装在上传，可以post base64格式，也可以构造blob对象上传，也可以用微信JSSDK上传

            var progress = 0;
            $.post("{:U('Picture/uploadPic64')}", {base64: base64}, function (data) {
              if (data.code == 200) {
                console.log(data);
                function uploading() {
                  $preview.find('.weui_uploader_status_content').text(++progress + '%');
                  if (progress < 100) {
                    setTimeout(uploading, 30);
                  }
                  else {
                    // 如果是失败，塞一个失败图标
                    //$preview.find('.weui_uploader_status_content').html('<i class="weui_icon_warn"></i>');
                    $preview.removeClass('weui_uploader_status').find('.weui_uploader_status_content').remove();
                  }
                }

                setTimeout(uploading, 30);
              } else {
                $preview.find('.weui_uploader_status_content').html('<i class="weui_icon_warn"></i>');
              }
            });
          };

          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
  });
  //# sourceURL=pen.js
</script>

</body>
</html>